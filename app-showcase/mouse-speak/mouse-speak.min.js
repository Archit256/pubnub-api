(function(){function x(a){var b=0,d=0;if(!a)a=window.event;if(!a)return[0,0];if(a.touches&&a.touches[0])PUBNUB.each(a.touches,function(e){b=e.pageX;d=e.pageY});else if(a.pageX||a.pageY){b=a.pageX;d=a.pageY}else if(a.clientX||a.clientY){b=a.clientX+m.scrollLeft+y.scrollLeft;d=a.clientY+m.scrollTop+y.scrollTop}b+=n*2;d+=n;if(b<=n*2)b=0;if(d<=n)d=0;return[b,d]}function h(a){if(i){var b=+new Date;if(z+l>b){clearTimeout(A);A=setTimeout(function(){h(a)},l);return 1}z=b;b=x(a);var d=J(),e={uuid:i};if(!(o[0]==
b[0]&&o[1]==b[1]||!b[0]||!b[1])){o[0]=b[0];o[1]=b[1];e.pos=b}if(B!=d||!(C%3)){B=d;e.txt=d||" ";p.set("mtxt",e.txt)}if(!(e.txt||e.pos))return 1;e.c=C++;PUBNUB.publish({channel:r,message:e});return 1}}function K(a){var b=a.pos||[100,100],d=f.create({image:{url:"http://www.pubnub.com/static/mouse.png",width:350,height:30,offset:{top:36,left:0}},cell:{count:1},left:b[1],top:b[0],framerate:34});g("mouseover",d.node,function(){if(i==a.uuid)return 1;PUBNUB.css(d.node,{textShadow:"#00ff00 0 0 18px"});f.move(d,
{opacity:0.5,top:1,left:1},l)});PUBNUB.css(d.node,{fontWeight:"bold",padding:"0 0 0 20px",fontSize:"14px",textShadow:"#000 1px 1px 2px",opacity:0,color:"#"+(a.uuid||"000000").slice(-6)});console.log("#"+(a.uuid||"000000").slice(-6));PUBNUB.attr(d.node,"uuid",a.uuid);s[a.uuid]=d;D(a)}function D(a){var b=a.pos,d=a.txt,e=a.c,c=s[a.uuid];if(a.click)return L(b);if(!(c.last&&e&&c.last>=e)){c.last=e;c.timerfade&&clearTimeout(c.timerfade);c.timerfade=setTimeout(function(){PUBNUB.css(c.node,{opacity:0.4});
clearTimeout(c.timerfade);c.timerfade=setTimeout(function(){PUBNUB.css(c.node,{display:"none"})},E)},E);PUBNUB.css(c.node,{display:"block",opacity:1});if(b){f.move(c,{top:b[1],left:b[0]},l);b[0]>c.left?f.setframe(c,0,{top:36}):f.setframe(c,0,{top:1})}if(d)c.node.innerHTML=d.replace(M,"")}}function L(a){var b=PUBNUB.create("div");if(!(a[1]&&a[0]))return 1;PUBNUB.css(b,{position:"absolute",background:"transparent url(http://www.pubnub.com/static/mouse-click.png) no-repeat",top:a[1],left:a[0],width:13,
height:13});m.appendChild(b);return 1}function N(a){setTimeout(function(){var b=a.keyCode;if(b==13||b==27)j.value=" ";h(a)},20);return 1}function O(){return t=1}function u(a){t=0;a=x(a);a[1]&&a[0]&&PUBNUB.publish({channel:r,message:{pos:a,click:1}});return 1}function J(){var a=j.value||"";if(a.length>F)j.value=a="..."+a.slice(-F);return a}if(window.location.href.indexOf("account")==-1)if(window.location.href.indexOf("app-showcase")==-1){var p={get:function(a){if(document.cookie.indexOf(a)==-1)return null;
return((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null},set:function(a,b){document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}},g=PUBNUB.bind,m=PUBNUB.search("body")[0],y=document.documentElement,s={},r="mouse-speak",E=9E3,j=PUBNUB.create("input"),t=0,o=[],B="",C=0,i=p.get("uuid"),l=200,F=34,n=20,A=0,z=0,M=/[<>]/g,f={create:function(a){a.intervals={animate:0,move:{}};a.cell.size=Math.floor(a.image.width/a.cell.count);a.node=PUBNUB.create("div");a.opacity=a.opacity||
1;PUBNUB.css(a.node,{opacity:a.opacity,position:"absolute",top:a.top,left:a.left,width:a.cell.size,height:a.image.height,backgroundRepeat:"no-repeat",backgroundImage:"url("+a.image.url+")"});f.setframe(a,0);f.append(a.node);return a},ground:PUBNUB.search("body")[0],append:function(a){f.ground.appendChild(a)},setframe:function(a,b,d){d=d||{};if(typeof d.top=="number")a.image.offset.top=d.top;if(typeof d.left=="number")a.image.offset.left=d.left;PUBNUB.css(a.node,{backgroundPosition:"-"+(a.cell.size*
b+a.image.offset.left)+"px -"+a.image.offset.top+"px"})},animate:function(a,b,d,e,c){if(!c){c=0;f.stop_animate(a)}if(c===b.length)if(d===0)return e&&e();else{d--;c=0}var k=b[c][0]||b[c];a.intervals.animate=setTimeout(function(){f.setframe(a,k);f.animate(a,b,d,e,c+1)},(b[c][1]||0.1)*1E3)},movie:function(a,b,d,e,c){if(!c){c=0;f.stop_all(a)}if(c===b.length)if(d===0)return e&&e();else{d--;c=0}if(b[c][2])f.animate(a,b[c][2],b[c][3]||0);f.move(a,b[c][0],b[c][1],function(){f.movie(a,b,d,e,c+1)})},move:function(a,
b,d,e){var c=+new Date;f.stop_all(a);PUBNUB.each(b,function(k,v){var q=c,G=c+d,H=a[k]||0,P=v-H,I={},w=k+v;f.stop_move(a,w);a.intervals.move[w]=setInterval(function(){q=+new Date;a[k]=G<=q?v:P*(q-c)/d+H;I[k]=a[k];PUBNUB.css(a.node,I);if(G<=q&&a.intervals.move){f.stop_move(a,w);e&&e()}},Math.ceil(1E3/a.framerate))})},stop_all:function(a){clearTimeout(a.intervals.animate);PUBNUB.each(a.intervals.move,function(b){clearInterval(a.intervals.move[b])})},stop_move:function(a,b){clearInterval(a.intervals.move[b])},
stop_animate:function(a){clearTimeout(a.intervals.animate)}};PUBNUB.subscribe({channel:r},function(a){if(!s[a.uuid])return K(a);D(a)});i||PUBNUB.uuid(function(a){i=a;console.log(i);p.set("uuid",i);setTimeout(function(){h({})},l)});PUBNUB.css(j,{position:"absolute",top:-10000,left:0});j.value=p.get("mtxt")||"Press ENTER, TYPE!!!";m.appendChild(j);g("mousemove",document,h);g("touchmove",document,h);g("touchstart",document,h);g("touchend",document,h);g("keydown",document,function(a){t||j.focus();N(a);
return 1});g("mousedown",document,u);g("click",document,u);PUBNUB.each(PUBNUB.search("input"),function(a){g("focus",a,O);g("blur",a,u)})}})();
