(function(){function I(a){var b=0,d=0;if(!a)a=window.event;if(!a)return[0,0];if(a.touches&&a.touches[0])PUBNUB.each(a.touches,function(e){b=e.pageX;d=e.pageY});else if(a.pageX||a.pageY){b=a.pageX;d=a.pageY}else if(a.clientX||a.clientY){b=a.clientX+p.scrollLeft+v.scrollLeft;d=a.clientY+p.scrollTop+v.scrollTop}b+=m*2;d+=m;if(b<=m*2)b=0;if(d<=m)d=0;return[b,d]}function h(a){if(k){var b=+new Date;if(w+l>b){clearTimeout(x);x=setTimeout(function(){h(a)},l);return 1}w=b;b=I(a);var d=J(),e={uuid:k};if(!(n[0]==
b[0]&&n[1]==b[1]||!b[0]||!b[1])){n[0]=b[0];n[1]=b[1];e.pos=b}if(y!=d||!(z%3)){y=d;e.txt=d||" ";q.set("mtxt",e.txt)}if(!(e.txt||e.pos))return 1;e.c=z++;PUBNUB.publish({channel:A,message:e});return 1}}function K(a){var b=a.pos||[100,100],d=f.create({image:{url:"http://www.pubnub.com/ju883jkslae83K8jfjvn/mouse.png",width:350,height:30,offset:{top:0,left:0}},cell:{count:1},left:b[1],top:b[0],framerate:24});g("mouseover",d.node,function(){if(k==a.uuid)return 1;PUBNUB.css(d.node,{textShadow:"#00ff00 0 0 18px",
color:"#990099"});f.move(d,{opacity:0.5,top:1,left:1},l)});PUBNUB.css(d.node,{fontWeight:"bold",padding:"0 0 0 20px",fontSize:"14px",textShadow:"#888 1px 1px 2px",opacity:0,color:"#000"});PUBNUB.attr(d.node,"uuid",a.uuid);r[a.uuid]=d;B(a)}function B(a){var b=a.pos,d=a.txt,e=a.c,c=r[a.uuid];if(!(c.last&&e&&c.last>=e)){c.last=e;c.timerfade&&clearTimeout(c.timerfade);c.timerfade=setTimeout(function(){PUBNUB.css(c.node,{opacity:0.4});clearTimeout(c.timerfade);c.timerfade=setTimeout(function(){PUBNUB.css(c.node,
{display:"none"})},C)},C);PUBNUB.css(c.node,{display:"block",opacity:1});b&&f.move(c,{top:b[1],left:b[0]},l);if(d)c.node.innerHTML=d.replace(L,"")}}function M(a){setTimeout(function(){if(a.keyCode==13)i.value=" ";h(a)},20);return 1}function N(){return s=1}function D(){s=0;return 1}function J(){var a=i.value||"";if(a.length>E)i.value=a="..."+a.slice(-E);return a}var q={get:function(a){if(document.cookie.indexOf(a)==-1)return null;return((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null},
set:function(a,b){document.cookie=a+"="+b}},g=PUBNUB.bind,p=PUBNUB.search("body")[0],v=document.documentElement,r={},A="mouse-speak",C=9E3,i=PUBNUB.create("input"),s=0,n=[],y="",z=0,k=null,l=200,E=30,m=-40,x=0,w=0,L=/[<>]/g,f={create:function(a){a.intervals={animate:0,move:{}};a.cell.size=Math.floor(a.image.width/a.cell.count);a.node=PUBNUB.create("div");a.opacity=a.opacity||1;PUBNUB.css(a.node,{opacity:a.opacity,position:"absolute",top:a.top,left:a.left,width:a.cell.size,height:a.image.height,backgroundRepeat:"no-repeat",
backgroundImage:"url("+a.image.url+")"});f.setframe(a,0);f.append(a.node);return a},ground:PUBNUB.search("body")[0],append:function(a){f.ground.appendChild(a)},setframe:function(a,b){PUBNUB.css(a.node,{backgroundPosition:"-"+(a.cell.size*b+a.image.offset.left)+"px -"+a.image.offset.top+"px"})},animate:function(a,b,d,e,c){if(!c){c=0;f.stop_animate(a)}if(c===b.length)if(d===0)return e&&e();else{d--;c=0}var j=b[c][0]||b[c];a.intervals.animate=setTimeout(function(){f.setframe(a,j);f.animate(a,b,d,e,c+
1)},(b[c][1]||0.1)*1E3)},movie:function(a,b,d,e,c){if(!c){c=0;f.stop_all(a)}if(c===b.length)if(d===0)return e&&e();else{d--;c=0}if(b[c][2])f.animate(a,b[c][2],b[c][3]||0);f.move(a,b[c][0],b[c][1],function(){f.movie(a,b,d,e,c+1)})},move:function(a,b,d,e){var c=+new Date;f.stop_all(a);PUBNUB.each(b,function(j,t){var o=c,F=c+d,G=a[j]||0,O=t-G,H={},u=j+t;f.stop_move(a,u);a.intervals.move[u]=setInterval(function(){o=+new Date;a[j]=F<=o?t:O*(o-c)/d+G;H[j]=a[j];PUBNUB.css(a.node,H);if(F<=o&&a.intervals.move){f.stop_move(a,
u);e&&e()}},Math.ceil(1E3/a.framerate))})},stop_all:function(a){clearTimeout(a.intervals.animate);PUBNUB.each(a.intervals.move,function(b){clearInterval(a.intervals.move[b])})},stop_move:function(a,b){clearInterval(a.intervals.move[b])},stop_animate:function(a){clearTimeout(a.intervals.animate)}};PUBNUB.subscribe({channel:A},function(a){if(!r[a.uuid])return K(a);B(a)});PUBNUB.uuid(function(a){k=a;q.set("uuid",k);setTimeout(function(){h({})},l)});PUBNUB.css(i,{position:"absolute",top:-10000,left:0});
i.value=q.get("mtxt")||"Press ENTER, TYPE!!!";p.appendChild(i);g("mousemove",document,h);g("touchmove",document,h);g("touchstart",document,h);g("touchend",document,h);g("keydown",document,function(a){s||i.focus();M(a);return 1});g("mousedown",document,D);PUBNUB.each(PUBNUB.search("input"),function(a){g("focus",a,N);g("blur",a,D)})})();
