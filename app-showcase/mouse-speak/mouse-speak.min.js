(function(){function z(a){var b=0,c=0;if(!a)return[0,0];if(a.touches&&a.touches[0])PUBNUB.each(a.touches,function(d){b=d.pageX;c=d.pageY});else if(a.pageX){b=a.pageX;c=a.pageY}else try{b=a.clientX+m.scrollLeft+A.scrollLeft;c=a.clientY+m.scrollTop+A.scrollTop}catch(f){}b+=n*2;c+=n;if(b<=n*2)b=0;if(c<=n)c=0;return[b,c]}function j(a){if(k){var b=+new Date;if(B+l>b){clearTimeout(C);C=setTimeout(function(){j(a)},l);return 1}B=b;b=z(a);var c=K(),f={uuid:k};if(!(o[0]==b[0]&&o[1]==b[1]||!b[0]||!b[1])){o[0]=
b[0];o[1]=b[1];f.pos=b}if(D!=c||!(L++%3)){D=c;f.txt=c||" ";p.set("mtxt",f.txt)}if(!(f.txt||f.pos))return 1;f.c=+new Date;q(f);PUBNUB.publish({channel:t,message:f});return 1}}function M(a){var b=a.pos||[100,100],c=g.create({image:{url:"http://www.pubnub.com/static/mouse.png",width:350,height:30,offset:{top:36,left:0}},cell:{count:1},left:b[1],top:b[0],framerate:50});k!=a.uuid&&h("mouseover",c.node,function(){PUBNUB.css(c.node,{textShadow:"#00ff00 0 0 18px"});g.move(c,{opacity:0.5,top:Math.ceil(Math.random()*
150),left:Math.ceil(Math.random()*150)},l)});PUBNUB.css(c.node,{fontWeight:"bold",padding:"5px 0 0 20px",fontSize:"15px",textShadow:"rgba(0,0,0,0.9) 1px 1px 2px","-webkit-box-shadow":"1px 1px 5px rgba(0,0,0,0.5)","-webkit-border-radius":"5px",opacity:0,backgroundColor:"rgba(255,255,255,0.6)",color:"#"+(a.uuid||"000000").slice(-6)});PUBNUB.attr(c.node,"uuid",a.uuid);E[a.uuid]=c;q(a)}function q(a){var b=a.pos,c=a.click,f=a.txt,d=a.c,e=E[a.uuid];console.log(JSON.stringify(a));if(!e)return M(a);if(c)return N(b);
if(!(d&&e.last&&e.last>d)){if(d||d<5)e.last=d;if(f)e.node.innerHTML=f.replace(O,"");e.timerfade&&clearTimeout(e.timerfade);e.timerfade=setTimeout(function(){PUBNUB.css(e.node,{opacity:0.4});clearTimeout(e.timerfade);e.timerfade=setTimeout(function(){PUBNUB.css(e.node,{display:"none"})},F)},F);PUBNUB.css(e.node,{display:"block",opacity:1});if(b){g.move(e,{top:b[1],left:b[0]},l+10);if(b[0]>e.left)g.setframe(e,0,{top:36});else b[0]<e.left&&g.setframe(e,0,{top:1})}}}function N(a){var b=PUBNUB.create("div");
if(!(a[1]&&a[0]))return 1;PUBNUB.css(b,{position:"absolute",background:"transparent url(http://www.pubnub.com/static/mouse-click.png) no-repeat",top:a[1],left:a[0],width:13,height:13});m.appendChild(b);return 1}function P(a,b){setTimeout(function(){if(",13,27,".indexOf(","+b+",")!==-1)i.value=" ";j(a)},20);return 1}function Q(){return u=1}function v(a){u=0;a=z(a);var b={pos:a,click:1,uuid:k};if(a[1]&&a[0]){q(b);PUBNUB.publish({channel:t,message:b})}return 1}function K(){var a=i.value||"",b=a.length;
if(b>G)i.value=a="..."+a.slice(-G);else if(a.indexOf(r)!=-1&&b>r.length)i.value=a=a.replace(r,"");return a}var w=window.location.href;if(w.indexOf("account")==-1)if(w.indexOf("app-showcase")==-1)if(w.indexOf("contact")==-1){var p={get:function(a){if(document.cookie.indexOf(a)==-1)return null;return((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null},set:function(a,b){document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}},h=PUBNUB.bind,m=PUBNUB.search("body")[0],A=
document.documentElement,E={},t="mouse-speak",F=9E3,i=PUBNUB.create("input"),u=0,o=[],D="",L=0,k=p.get("uuid")||0,l=90,G=34,n=10,C=0,B=0,O=/[<>]/g,g={create:function(a){a.intervals={animate:0,move:{}};a.cell.size=Math.floor(a.image.width/a.cell.count);a.node=PUBNUB.create("div");a.opacity=a.opacity||1;PUBNUB.css(a.node,{opacity:a.opacity,position:"absolute",top:a.top,left:a.left,width:a.cell.size,height:a.image.height,backgroundRepeat:"no-repeat",backgroundImage:"url("+a.image.url+")"});g.setframe(a,
0);g.append(a.node);return a},ground:PUBNUB.search("body")[0],append:function(a){g.ground.appendChild(a)},setframe:function(a,b,c){c=c||{};if(typeof c.top=="number")a.image.offset.top=c.top;if(typeof c.left=="number")a.image.offset.left=c.left;PUBNUB.css(a.node,{backgroundPosition:"-"+(a.cell.size*b+a.image.offset.left)+"px -"+a.image.offset.top+"px"})},animate:function(a,b,c,f,d){if(!d){d=0;g.stop_animate(a)}if(d===b.length)if(c===0)return f&&f();else{c--;d=0}var e=b[d][0]||b[d];a.intervals.animate=
setTimeout(function(){g.setframe(a,e);g.animate(a,b,c,f,d+1)},(b[d][1]||0.1)*1E3)},movie:function(a,b,c,f,d){if(!d){d=0;g.stop_all(a)}if(d===b.length)if(c===0)return f&&f();else{c--;d=0}if(b[d][2])g.animate(a,b[d][2],b[d][3]||0);g.move(a,b[d][0],b[d][1],function(){g.movie(a,b,c,f,d+1)})},move:function(a,b,c,f){var d=+new Date;g.stop_all(a);PUBNUB.each(b,function(e,x){var s=d,H=d+c,I=a[e]||0,R=x-I,J={},y=e+x;g.stop_move(a,y);a.intervals.move[y]=setInterval(function(){s=+new Date;a[e]=H<=s?x:R*(s-d)/
c+I;J[e]=a[e];PUBNUB.css(a.node,J);if(H<=s&&a.intervals.move){g.stop_move(a,y);f&&f()}},Math.ceil(1E3/a.framerate))})},stop_all:function(a){clearTimeout(a.intervals.animate);PUBNUB.each(a.intervals.move,function(b){clearInterval(a.intervals.move[b])})},stop_move:function(a,b){clearInterval(a.intervals.move[b])},stop_animate:function(a){clearTimeout(a.intervals.animate)}};PUBNUB.subscribe({channel:t},q);k||PUBNUB.uuid(function(a){k=a;p.set("uuid",k);setTimeout(function(){j({})},l)});PUBNUB.css(i,{position:"absolute",
top:-10000,left:0});var r="TYPE!!!";i.value=p.get("mtxt")||r;m.appendChild(i);h("mousemove",document,j);h("touchmove",document,j);h("touchstart",document,j);h("touchend",document,j);h("keydown",document,function(a){var b=a.keyCode;if(",18,37,38,39,40,20,17,35,36,33,34,16,9,91,".indexOf(","+b+",")!==-1)return 1;u||i.focus();P(a,b);return 1});h("mousedown",document,v);h("click",document,v);PUBNUB.each(PUBNUB.search("input"),function(a){h("focus",a,Q);h("blur",a,v)})}})();
