(function(){function C(t,m){var q,a=0;function c(){if(a+m>+new Date){clearTimeout(q);q=setTimeout(c,m)}else{a=+new Date;t()}}return c}var i=PUBNUB,J=i.$,f=i.attr,D=i.css,E=i.each,r=i.create,w=i.supplant,K=i.publish,L=i.subscribe,M=i.history,u=setInterval,N=setTimeout,F=this.location.href.slice(-400),h=J("traffic-beat-2"),G='<div class="traffic-beat-clear"></div>',O=f(h,"interface")=="on",x=f(h,"channel"),P=+f(h,"interval"),Q=f(h,"demo"),H=+f(h,"url-display-limit")||5,I=[],j={},v={},y=0,z=0;(function(){function t(a){K({channel:x,
message:{page:a}})}t(F);if(O){(function(){var a=r("div");f(a,"class","traffic-beat-ticker-line-box");h.appendChild(a);for(var c=0;c<68;c++){var e=r("div");e.left=c*6;f(e,"class","traffic-beat-ticker-line-off");D(e,{left:e.left});I.push(e);a.appendChild(e)}u(function(){for(var k=0,d;k<68;k++){d=I[k];d.left-=2;if(d.left<-6){d.left=400;if(a.c){a.c=0;f(a,"class","traffic-beat-ticker-line-box")}if(z>0){a.c=1;f(a,"class","traffic-beat-ticker-line-box-highlight");z--;f(d,"class","traffic-beat-ticker-line-on");
d.d=1}else if(d.d){f(d,"class","traffic-beat-ticker-line-off");d.d=0}}D(d,{left:d.left})}},P)})();(function(){u(function(){},1E4)})();var m;(function(){function a(b,g,n){b.innerHTML=[A.replace(d,">"+g+"<"),B.replace(d,">"+n+"<"),Array(1+Math.ceil(g)).join(o)||o,G].join("")}var c=r("div"),e=r("div"),k=r("div"),d=/></,A='<div class="traffic-beat-bar-text-rpm"></div>',B='<div class="traffic-beat-bar-text"></div>',o='<div class="traffic-beat-bar"><div class="traffic-beat-bar-shine"></div></div>';f(c,
"class","traffic-beat-bar-box");f(e,"class","traffic-beat-bar-box");f(k,"class","traffic-beat-bar-box");h.appendChild(c);h.appendChild(e);h.appendChild(k);m=C(function(){var b=0,g=0,n=0,s=+new Date;for(var l in v){var p=(s-l)/1E3;if(3610<p)delete v[l];else{61>p&&b++;601>p&&g++;3601>p&&n++}}g/=10;n/=60;a(c,b,"RPM Instant");a(e,g,"10 Minute Average");a(k,n,"60 Minute Average")},500);u(m,2E3)})();Q&&u(function(){N(function(){t(F+"#"+Math.ceil(Math.random()*H))},Math.ceil(Math.random()*6E3+600))},1E3);
var q;(function(){function a(o,b,g){b=Math.ceil(b*100);b=b>90?90:b;b=b<6?6:b;e.push('<div class="traffic-beat-percent-bar" ',"onmouseup=\"location.href='",o,"'\">",d,w(A,{text:"/"+o.split("/").slice(3).join("/").substr(0,60)}),w(B,{percent:b,count:g}),w(k,{percent:b}),G,"</div>")}var c=r("div"),e=[],k='<div class="traffic-beat-percent-bar-meter" style="width:{percent}%"></div>',d='<div class="traffic-beat-percent-bar-shine"></div>',A='<div class="traffic-beat-percent-bar-text-url">{text}</div>',B=
'<div class="traffic-beat-percent-bar-text-percent">{count} ({percent}%)</div>';h.appendChild(c);q=C(function(){var o=0,b=[];e=[];e.push('<div class="traffic-beat-sep"></div>');E(j,function(s,l){b.push({page:s,a:l.a,b:l.b})});b.sort(function(s,l){var p=l.b-s.b;if(!p)return l.a-s.a;return p});for(var g=0,n=b.length;g<n;g++)o++>H||a(b[g].page,b[g].a/y,b[g].a);c.innerHTML=e.join("")},1E3)})();L({channel:x},function(a){z++;y++;j[a.page]||(j[a.page]={url:a.page,a:0});j[a.page].a++;j[a.page].b=+new Date;
v[+new Date]=1;q();m()});M({channel:x,limit:100},function(a){E(a,function(c){y++;j[c.page]||(j[c.page]={url:c.page,a:0});j[c.page].a++;j[c.page].b=+new Date;v[+new Date]=1;q();m()})})}})()})();
